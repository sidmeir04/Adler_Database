<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <script src="bootstrap/js/bootstrap.bundle.min.js"></script>
    <title>Document</title>
    <style>
        .nav-pills .nav-link {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="member_id" hidden value=""></div>
    <div class="enrollment_form_id" hidden value=""></div>
    <div class="medical_history_id" hidden value=""></div>
    <div class="ec1_id" hidden value=""></div>
    <div class="ec2_id" hidden value=""></div>
    <div class="container mt-5">
        <h2>Add Member</h2>
    
        <!-- Navigation Menu -->
        <ul class="nav nav-pills mb-3" id="form-nav">
            <li class="nav-item"><a class="nav-link active" href="#" data-step="0">Member Info</a></li>
            <li class="nav-item"><a class="nav-link" href="#" data-step="1">Medical History Form</a></li>
            <li class="nav-item"><a class="nav-link" href="#" data-step="2">Enrollment Form</a></li>
            <li class="nav-item"><a class="nav-link" href="#" data-step="3">Emergency Contact One</a></li>
            <li class="nav-item"><a class="nav-link" href="#" data-step="4">Emergency Contact Two</a></li>
        </ul>
    
        <form id="memberForm">
            <div class="form-step">
                <div class="mb-3">
                    <label for="name" class="form-label">Name</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>
                <div class="mb-3">
                    <label for="age" class="form-label">Age</label>
                    <input type="number" class="form-control" id="age" name="age" required>
                </div>
                <div class="mb-3">
                    <label for="dob" class="form-label">Date of Birth</label>
                    <input type="date" class="form-control" id="dob" name="dob" required>
                </div>
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                </div>
                <div class="mb-3">
                    <label for="phoneNumber" class="form-label">Phone Number</label>
                    <input type="tel" class="form-control" id="phoneNumber" name="phoneNumber" required>
                </div>
                <div class="mb-3">
                    <label for="address" class="form-label">Address</label>
                    <input type="text" class="form-control" id="address" name="address" required>
                </div>
                <div class="mb-3">
                    <label for="county" class="form-label">County</label>
                    <input type="text" class="form-control" id="county" name="county" required>
                </div>
                <div class="mb-3">
                    <label for="gender" class="form-label">Gender</label>
                    <select class="form-select" id="gender" name="gender" required>
                        <option value="" selected disabled>Select Gender</option>
                        <option value="M">Male</option>
                        <option value="F">Female</option>
                        <option value="O">Other</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="veteran" class="form-label">Veteran</label>
                    <select class="form-select" id="veteran" name="veteran" required>
                        <option value="" selected disabled>Select Veteran Status</option>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success">Add new member</button>
            </div>
        </form>

        <form id="MedicalHistoryForm">
            <div class="form-step d-none">
                <button type="submit" class="btn btn-success">Add new member</button>
            </div>
        </form>

        <form id="EnrollmentForm">
            <div class="form-step d-none">
                <div class="mb-3">
                    <label for="aphasia_cause" class="form-label">Aphasia Cause</label>
                    <input type="text" class="form-control" id="aphasia_cause" name="aphasia_cause" required>
                </div>
                <div class="mb-3">
                    <label for="aphasia_onset" class="form-label">Aphasia Onset</label>
                    <input type="date" class="form-control" id="aphasia_onset" name="aphasia_onset" required>
                </div>
                <div class="mb-3">
                    <label for="brain_location" class="form-label">Brain Location</label>
                    <input type="text" class="form-control" id="brain_location" name="brain_location" required>
                </div>
                <div class="mb-3">
                    <label for="completed_date" class="form-label">Completed Date</label>
                    <input type="date" class="form-control" id="completed_date" name="completed_date" required>
                </div>
                <div class="mb-3">
                    <label for="filled_by" class="form-label">Filled By</label>
                    <input type="text" class="form-control" id="filled_by" name="filled_by" required>
                </div>
                <div class="mb-3">
                    <label for="grew_up" class="form-label">Grew Up</label>
                    <input type="text" class="form-control" id="grew_up" name="grew_up" required>
                </div>
                <div class="mb-3">
                    <label for="hearing_aid" class="form-label">Hearing Aid</label>
                    <select class="form-select" id="hearing_aid" name="hearing_aid" required>
                        <option value="" selected disabled>Select Option</option>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="hearing_loss" class="form-label">Hearing Loss</label>
                    <select class="form-select" id="hearing_loss" name="hearing_loss" required>
                        <option value="" selected disabled>Select Option</option>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="income" class="form-label">Income</label>
                    <input type="number" class="form-control" id="income" name="income" required>
                </div>
                <div class="mb-3">
                    <label for="living_status" class="form-label">Living Status</label>
                    <input type="text" class="form-control" id="living_status" name="living_status" required>
                </div>
                <div class="mb-3">
                    <label for="medications" class="form-label">Medications</label>
                    <textarea class="form-control" id="medications" name="medications" rows="3" required></textarea>
                </div>
                <div class="mb-3">
                    <label for="occupations" class="form-label">Occupations</label>
                    <textarea class="form-control" id="occupations" name="occupations" rows="3" required></textarea>
                </div>
                <div class="mb-3">
                    <label for="other_therapy" class="form-label">Other Therapy</label>
                    <textarea class="form-control" id="other_therapy" name="other_therapy" rows="3" required></textarea>
                </div>
                <div class="mb-3">
                    <label for="patient_info" class="form-label">Patient Info</label>
                    <textarea class="form-control" id="patient_info" name="patient_info" rows="3" required></textarea>
                </div>
                <div class="mb-3">
                    <label for="prev_speech_therapy" class="form-label">Previous Speech Therapy</label>
                    <select class="form-select" id="prev_speech_therapy" name="prev_speech_therapy" required>
                        <option value="" selected disabled>Select Option</option>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="race" class="form-label">Race</label>
                    <input type="text" class="form-control" id="race" name="race" required>
                </div>
                <div class="mb-3">
                    <label for="sexual_orientation" class="form-label">Sexual Orientation</label>
                    <input type="text" class="form-control" id="sexual_orientation" name="sexual_orientation" required>
                </div>
                <button type="submit" class="btn btn-success">Add Enrollemnt Form</button>
            </div>
        </form>

        <form id="EC1">
            <div class="form-step d-none">
                <div class="mb-3">
                    <label for="name" class="form-label">Contact Name</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>
                <div class="mb-3">
                    <label for="relationship" class="form-label">Relation to Member</label>
                    <input type="text" class="form-control" id="relationship" name="relationship" required>
                </div>
                <div class="mb-3">
                    <label for="cell_phone" class="form-label">Phone Number</label>
                    <input type="tel" class="form-control" id="cell_phone" name="cell_phone" required>
                </div>
                <div class="mb-3">
                    <label for="day_phone" class="form-label">Day Phone</label>
                    <input type="tel" class="form-control" id="day_phone" name="day_phone" required>
                </div>
                <div class="mb-3">
                    <label for="evening_phone" class="form-label">Evening Phone</label>
                    <input type="tel" class="form-control" id="evening_phone" name="evening_phone" required>
                </div>
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                </div>
                <div class="mb-3">
                    <label for="address" class="form-label">Address</label>
                    <input type="text" class="form-control" id="address" name="address" required>
                </div>
                <button type="submit" class="btn btn-success">Create Emergency Contact One</button>
            </div>
        </form>

        <form id="EC2">
            <div class="form-step d-none">
                <div class="mb-3">
                    <label for="name" class="form-label">Contact Name</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>
                <div class="mb-3">
                    <label for="relationship" class="form-label">Relation to Member</label>
                    <input type="text" class="form-control" id="relationship" name="relationship" required>
                </div>
                <div class="mb-3">
                    <label for="cell_phone" class="form-label">Phone Number</label>
                    <input type="tel" class="form-control" id="cell_phone" name="cell_phone" required>
                </div>
                <div class="mb-3">
                    <label for="day_phone" class="form-label">Day Phone</label>
                    <input type="tel" class="form-control" id="day_phone" name="day_phone" required>
                </div>
                <div class="mb-3">
                    <label for="evening_phone" class="form-label">Evening Phone</label>
                    <input type="tel" class="form-control" id="evening_phone" name="evening_phone" required>
                </div>
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                </div>
                <div class="mb-3">
                    <label for="address" class="form-label">Address</label>
                    <input type="text" class="form-control" id="address" name="address" required>
                </div>
                <button type="submit" class="btn btn-success">Create Emergency Contact Two</button>
            </div>
        </form>
    </div>

    <script>
        document.getElementById('memberForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const formObject = {};
            formData.forEach((value, key) => {
                formObject[key] = value;
            });
            formObject['id'] = getMemberID();
            const jsonString = JSON.stringify(formObject, null, 2);
            console.log(jsonString);
            if(getMemberID() == undefined || getMemberID() == '') {
                window.addMember(jsonString).then(function(id) {
                    console.log("Returned ID:", id);
                    updateMemberID(id);
                }).catch(function(error) {
                    console.log(id);
                    console.error("Error:", error);
                });
            } else {
                window.updateMember(jsonString);
            }
        });
        document.getElementById('EnrollmentForm').addEventListener('submit', function(event) {
            event.preventDefault();
            if(getMemberID() == undefined || getMemberID() == '') {
                alert("Please save the member information first before adding emergency contact details.");
                console.error("Member ID not set");
                return;
            }
            const formData = new FormData(event.target);
            const formObject = {};
            formData.forEach((value, key) => {
                formObject[key] = value;
            });
            formObject['id'] = getEnrollmentFormID();
            const jsonString = JSON.stringify(formObject, null, 2);
            console.log(jsonString);
            // need to add code to also update the member's emergency contact ID
            if(getEnrollmentFormID() == undefined || getEnrollmentFormID() == '') {
                window.addEnrollmentForm(jsonString).then(function(id) {
                    console.log("Returned ID:", id);
                    updateEnrollmentFormID(id);
                    const payload = JSON.stringify({
                        "id": getMemberID()[0],
                        "enrollment_form": id
                    });

                    console.log("Payload:", payload);
                    window.updateMember(payload);
                }).catch(function(error) {
                    console.error("Error:", error);
                });
            } else {
                window.updateEnrollmentForm(jsonString);
            }
        });
        document.getElementById('EC1').addEventListener('submit', function(event) {
            event.preventDefault();
            if(getMemberID() == undefined || getMemberID() == '') {
                alert("Please save the member information first before adding emergency contact details.");
                console.error("Member ID not set");
                return;
            }
            const formData = new FormData(event.target);
            const formObject = {};
            formData.forEach((value, key) => {
                formObject[key] = value;
            });
            formObject['id'] = getEC1ID();
            const jsonString = JSON.stringify(formObject, null, 2);
            console.log(jsonString);
            // need to add code to also update the member's emergency contact ID
            if(getEC1ID() == undefined || getEC1ID() == '') {
                window.addEC(jsonString).then(function(id) {
                    console.log("Returned ID:", id);
                    updateEC1ID(id);
                    const payload = JSON.stringify({
                        "id": getMemberID()[0],
                        "emergency_contact_one": id
                    });

                    console.log("Payload:", payload);
                    window.updateMember(payload);
                }).catch(function(error) {
                    console.error("Error:", error);
                });
            } else {
                window.updateEC(jsonString);
            }
        });
        document.getElementById('EC2').addEventListener('submit', function(event) {
            event.preventDefault();
            if(getMemberID() == undefined || getMemberID() == '') {
                alert("Please save the member information first before adding emergency contact details.");
                console.error("Member ID not set");
                return;
            }
            const formData = new FormData(event.target);
            const formObject = {};
            formData.forEach((value, key) => {
                formObject[key] = value;
            });
            formObject['id'] = getEC2ID();
            const jsonString = JSON.stringify(formObject, null, 2);
            console.log(jsonString);
            if(getEC2ID() == undefined || getEC2ID() == '') {
                window.addEC(jsonString).then(function(id) {
                    console.log("Returned ID:", id);
                    updateEC2ID(id);
                    const payload = JSON.stringify({
                        "id": getMemberID()[0],
                        "emergency_contact_two": id
                    });

                    window.updateMember(payload);
                }).catch(function(error) {
                    console.log(id);
                    console.error("Error:", error);
                });
            } else {
                window.updateEC(jsonString);
            }
        });
        document.addEventListener("DOMContentLoaded", function () {
            const steps = document.querySelectorAll(".form-step");
            const navLinks = document.querySelectorAll("#form-nav .nav-link");
            let currentStep = 0;

            function showStep(stepIndex) {
                steps.forEach((step, index) => {
                    step.classList.toggle("d-none", index !== stepIndex);
                });
                navLinks.forEach((link, index) => {
                    link.classList.toggle("active", index === stepIndex);
                });
            }

            // Navigation Menu Click Handling
            navLinks.forEach((link) => {
                link.addEventListener("click", function (e) {
                    e.preventDefault();
                    const stepIndex = parseInt(this.getAttribute("data-step"));
                    currentStep = stepIndex;
                    showStep(currentStep);
                });
            });

            showStep(currentStep);
        });

        function initializeFormData(jsonString){
            console.log(jsonString);
            const data = JSON.parse(jsonString);
            const userData = data.userData;
            const memberForm = document.getElementById('memberForm');
            document.querySelector('.member_id').value = userData.id;
            memberForm.querySelector('#name').value = userData.name;
            memberForm.querySelector('#age').value = userData.age;
            memberForm.querySelector('#dob').value = userData.dob;
            memberForm.querySelector('#email').value = userData.email;
            memberForm.querySelector('#phoneNumber').value = userData.phone;
            memberForm.querySelector('#address').value = userData.address;
            memberForm.querySelector('#county').value = userData.county;
            const genderSelect = memberForm.querySelector("#gender");
            for (let option of genderSelect.options) {
                if (option.value == userData.gender) {
                    option.selected = true;
                    break;
                }
            }
            const veteranSelect = memberForm.querySelector("#veteran");
            for (let option of veteranSelect.options) {
                if (option.value == userData.veteran) {
                    option.selected = true;
                    break;
                }
            }
            const ec1Data = data.emergencyContactOne;
            const ec1Form = document.getElementById('EC1');
            document.querySelector('.ec1_id').value = ec1Data.id;
            ec1Form.querySelector('#name').value = ec1Data.name;
            ec1Form.querySelector('#relationship').value = ec1Data.relationship;
            ec1Form.querySelector('#cell_phone').value = ec1Data.cell_phone;
            ec1Form.querySelector('#day_phone').value = ec1Data.day_phone;
            ec1Form.querySelector('#evening_phone').value = ec1Data.evening_phone;
            ec1Form.querySelector('#email').value = ec1Data.email;
            ec1Form.querySelector('#address').value = ec1Data.address;

            const ec2Data = data.emergencyContactTwo;
            const ec2Form = document.getElementById('EC2');
            document.querySelector('.ec2_id').value = ec2Data.id;
            ec2Form.querySelector('#name').value = ec2Data.name;
            ec2Form.querySelector('#relationship').value = ec2Data.relationship;
            ec2Form.querySelector('#cell_phone').value = ec2Data.cell_phone;
            ec2Form.querySelector('#day_phone').value = ec2Data.day_phone;
            ec2Form.querySelector('#evening_phone').value = ec2Data.evening_phone;
            ec2Form.querySelector('#email').value = ec2Data.email;
            ec2Form.querySelector('#address').value = ec2Data.address;
        }

        
        function updateMemberID(id) {
            document.querySelector('.member_id').value = id;
        }
        function getMemberID() {
            return document.querySelector('.member_id').value;
        }
        function updateEnrollmentFormID(id) {
            document.querySelector('.enrollment_form_id').value = id;
        }
        function getEnrollmentFormID() {
            return document.querySelector('.enrollment_form_id').value;
        }
        function updateMedicalHistoryID(id) {
            document.querySelector('.medical_history_id').value = id;
        }
        function getMedicalHistoryID() {
            return document.querySelector('.medical_history_id').value;
        }
        function updateEC1ID(id) {
            document.querySelector('.ec1_id').value = id;
        }
        function getEC1ID() {
            return document.querySelector('.ec1_id').value;
        }
        function updateEC2ID(id) {
            document.querySelector('.ec2_id').value = id;
        }
        function getEC2ID() {
            return document.querySelector('.ec2_id').value;
        }
    </script>
</body>
</html>
