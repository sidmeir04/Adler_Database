<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <script src="bootstrap/js/bootstrap.bundle.min.js"></script>
    <title>Document</title>
    <style>
        .nav-pills .nav-link {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="member_id" hidden value=""></div>
    <div class="enrollment_form_id" hidden value=""></div>
    <div class="medical_history_id" hidden value=""></div>
    <div class="ec1_id" hidden value=""></div>
    <div class="ec2_id" hidden value=""></div>
    <div class="container mt-5">
        <h2>Add Member</h2>
    
        <!-- Navigation Menu -->
        <ul class="nav nav-pills mb-3" id="form-nav">
            <li class="nav-item"><a class="nav-link active" href="#" data-step="0">Member Info</a></li>
            <li class="nav-item"><a class="nav-link" href="#" data-step="1">Contact Info</a></li>
            <li class="nav-item"><a class="nav-link" href="#" data-step="2">Address</a></li>
            <li class="nav-item"><a class="nav-link" href="#" data-step="3">Emergency Contact One</a></li>
            <li class="nav-item"><a class="nav-link" href="#" data-step="4">Emergency Contact Two</a></li>
        </ul>
    
        <form id="memberForm">
            <div class="form-step">
                <div class="mb-3">
                    <label for="name" class="form-label">Name</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>
                <div class="mb-3">
                    <label for="age" class="form-label">Age</label>
                    <input type="number" class="form-control" id="age" name="age" required>
                </div>
                <div class="mb-3">
                    <label for="dob" class="form-label">Date of Birth</label>
                    <input type="date" class="form-control" id="dob" name="dob" required>
                </div>
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                </div>
                <div class="mb-3">
                    <label for="phoneNumber" class="form-label">Phone Number</label>
                    <input type="tel" class="form-control" id="phoneNumber" name="phoneNumber" required>
                </div>
                <div class="mb-3">
                    <label for="address" class="form-label">Address</label>
                    <input type="text" class="form-control" id="address" name="address" required>
                </div>
                <div class="mb-3">
                    <label for="county" class="form-label">County</label>
                    <input type="text" class="form-control" id="county" name="county" required>
                </div>
                <div class="mb-3">
                    <label for="gender" class="form-label">Gender</label>
                    <select class="form-select" id="gender" name="gender" required>
                        <option value="" selected disabled>Select Gender</option>
                        <option value="M">Male</option>
                        <option value="F">Female</option>
                        <option value="O">Other</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="veteran" class="form-label">Veteran</label>
                    <select class="form-select" id="veteran" name="veteran" required>
                        <option value="" selected disabled>Select Veteran Status</option>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success">Add new member</button>
            </div>
        </form>

        <form id="MedicalHistoryForm">
            <div class="form-step d-none">
                <button type="submit" class="btn btn-success">Add new member</button>
            </div>
        </form>

        <form id="EnrollmentForm">
            <div class="form-step d-none">
                <button type="submit" class="btn btn-success">Add new member</button>
            </div>
        </form>

        <form id="EC1">
            <div class="form-step d-none">
                <div class="mb-3">
                    <label for="Name" class="form-label">Contact Name</label>
                    <input type="text" class="form-control" id="Name" name="Name" required>
                </div>
                <div class="mb-3">
                    <label for="Relation" class="form-label">Relation to Member</label>
                    <input type="text" class="form-control" id="Relation" name="Relation" required>
                </div>
                <div class="mb-3">
                    <label for="PhoneNumber" class="form-label">Phone Number</label>
                    <input type="tel" class="form-control" id="PhoneNumber" name="PhoneNumber" required>
                </div>
                <div class="mb-3">
                    <label for="DayPhone" class="form-label">Day Phone</label>
                    <input type="tel" class="form-control" id="DayPhone" name="DayPhone" required>
                </div>
                <div class="mb-3">
                    <label for="EveningPhone" class="form-label">Evening Phone</label>
                    <input type="tel" class="form-control" id="EveningPhone" name="EveningPhone" required>
                </div>
                <div class="mb-3">
                    <label for="Email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="Email" name="Email" required>
                </div>
                <div class="mb-3">
                    <label for="Address" class="form-label">Address</label>
                    <input type="text" class="form-control" id="Address" name="Address" required>
                </div>
                <button type="submit" class="btn btn-success">Add new member</button>
            </div>
        </form>

        <form id="EC2">
            <div class="form-step d-none">
                <div class="mb-3">
                    <label for="Name" class="form-label">Contact Name</label>
                    <input type="text" class="form-control" id="Name" name="Name" required>
                </div>
                <div class="mb-3">
                    <label for="Relation" class="form-label">Relation to Member</label>
                    <input type="text" class="form-control" id="Relation" name="Relation" required>
                </div>
                <div class="mb-3">
                    <label for="PhoneNumber" class="form-label">Phone Number</label>
                    <input type="tel" class="form-control" id="PhoneNumber" name="PhoneNumber" required>
                </div>
                <div class="mb-3">
                    <label for="DayPhone" class="form-label">Day Phone</label>
                    <input type="tel" class="form-control" id="DayPhone" name="DayPhone" required>
                </div>
                <div class="mb-3">
                    <label for="EveningPhone" class="form-label">Evening Phone</label>
                    <input type="tel" class="form-control" id="EveningPhone" name="EveningPhone" required>
                </div>
                <div class="mb-3">
                    <label for="Email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="Email" name="Email" required>
                </div>
                <div class="mb-3">
                    <label for="Address" class="form-label">Address</label>
                    <input type="text" class="form-control" id="Address" name="Address" required>
                </div>
                <button type="submit" class="btn btn-success">Add new member</button>
            </div>
        </form>
    </div>

    <script>
        document.getElementById('memberForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const formObject = {};
            formData.forEach((value, key) => {
                formObject[key] = value;
            });
            formObject['id'] = getMemberID();
            const jsonString = JSON.stringify(formObject, null, 2);
            console.log(jsonString);
            if(getMemberID() == undefined || getMemberID() == '') {
                window.addMember(jsonString).then(function(id) {
                    console.log("Returned ID:", id);
                    updateMemberID(id);
                }).catch(function(error) {
                    console.log(id);
                    console.error("Error:", error);
                });
            } else {
                window.updateMember(jsonString);
            }
        });
        document.getElementById('EC1').addEventListener('submit', function(event) {
            event.preventDefault();
            if(getMemberID() == undefined || getMemberID() == '') {
                alert("Please save the member information first before adding emergency contact details.");
                console.error("Member ID not set");
                return;
            }
            const formData = new FormData(event.target);
            const formObject = {};
            formData.forEach((value, key) => {
                formObject[key] = value;
            });
            formObject['id'] = getEC1ID();
            const jsonString = JSON.stringify(formObject, null, 2);
            console.log(jsonString);
            // need to add code to also update the member's emergency contact ID
            if(getEC1ID() == undefined || getEC1ID() == '') {
                window.addEC(jsonString).then(function(id) {
                    console.log("Returned ID:", id);
                    updateEC1ID(id);
                }).catch(function(error) {
                    console.log(id);
                    console.error("Error:", error);
                });
                const paylaod = {
                    "id": getMemberID(),
                    "emergency_contact_one": id
                };
                window.updateMember(payload);
            } else {
                window.updateEC(jsonString);
            }
        });
        document.getElementById('EC2').addEventListener('submit', function(event) {
            event.preventDefault();
            if(getMemberID() == undefined || getMemberID() == '') {
                alert("Please save the member information first before adding emergency contact details.");
                console.error("Member ID not set");
                return;
            }
            const formData = new FormData(event.target);
            const formObject = {};
            formData.forEach((value, key) => {
                formObject[key] = value;
            });
            formObject['id'] = getEC2ID();
            const jsonString = JSON.stringify(formObject, null, 2);
            console.log(jsonString);
            if(getEC2ID() == undefined || getEC2ID() == '') {
                window.addEC(jsonString).then(function(id) {
                    console.log("Returned ID:", id);
                    updateEC2ID(id);
                }).catch(function(error) {
                    console.log(id);
                    console.error("Error:", error);
                });
                const paylaod = {
                    "id": getMemberID(),
                    "emergency_contact_two": id
                };
                window.updateMember(payload);
            } else {
                window.updateEC(jsonString);
            }
        });
        document.addEventListener("DOMContentLoaded", function () {
            const steps = document.querySelectorAll(".form-step");
            const navLinks = document.querySelectorAll("#form-nav .nav-link");
            let currentStep = 0;

            function showStep(stepIndex) {
                steps.forEach((step, index) => {
                    step.classList.toggle("d-none", index !== stepIndex);
                });
                navLinks.forEach((link, index) => {
                    link.classList.toggle("active", index === stepIndex);
                });
            }

            // Navigation Menu Click Handling
            navLinks.forEach((link) => {
                link.addEventListener("click", function (e) {
                    e.preventDefault();
                    const stepIndex = parseInt(this.getAttribute("data-step"));
                    currentStep = stepIndex;
                    showStep(currentStep);
                });
            });

            showStep(currentStep);
        });

        
        function updateMemberID(id) {
            document.querySelector('.member_id').value = id;
        }
        function getMemberID() {
            return document.querySelector('.member_id').value;
        }
        function updateEnrollmentFormID(id) {
            document.querySelector('.enrollment_form_id').value = id;
        }
        function getEnrollmentFormID() {
            return document.querySelector('.enrollment_form_id').value;
        }
        function updateMedicalHistoryID(id) {
            document.querySelector('.medical_history_id').value = id;
        }
        function getMedicalHistoryID() {
            return document.querySelector('.medical_history_id').value;
        }
        function updateEC1ID(id) {
            document.querySelector('.ec1_id').value = id;
        }
        function getEC1ID() {
            return document.querySelector('.ec1_id').value;
        }
        function updateEC2ID(id) {
            document.querySelector('.ec2_id').value = id;
        }
        function getEC2ID() {
            return document.querySelector('.ec2_id').value;
        }
    </script>
</body>
</html>
